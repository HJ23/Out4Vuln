from utils.utilities import *
from core.AttackerBase import *
urllib3.disable_warnings()

class HHI(AttackerBase):
  def __init__(self,reporter):
      super().__init__(reporter)
      self.__headers=["Host","X-Forwarded-For","X-Forwarded-Host","X-Forwarded-Proto",\
               "X-Forwarded-Server","X-Host","Forwarded","X-HTTP-Host-Override","X-Rewrite-Url",
               "X-Originating-IP","X-Remote-IP","X-Remote-Addr","X-Client-IP","X-Original-Url"]
  def start(self,urls):
      perm_headers=self.requester.__headers
      for url in urls:
          for header in self.__headers:
              temp_headers=perm_headers.copy()
              temp_headers[header]=Configs.ConstDomain+".test.com"
              self.requester.__headers=temp_headers
              resp=self.requester.send_get(url)              
              if(not resp is None):
                  if("test.com" in resp.text):
                      self.reporter.addRow(url,[header,"Cached : "+str(cache_check(resp.headers))])
                      
          rand_sleep()
      self.reporter.save()
      self.cached_resps.finalize()
      
          