from utils.utilities import *
from core.AttackerBase import *
from utils.levels import ImportanceLevel

class CORS(AttackerBase):
    def __init__(self,reporter):
        super().__init__(reporter)
    def start(self,urls):
        results={"url":[],"header":[]}
        origin_headers=[Configs.ConstDomain+"@"+"test.com",Configs.ConstDomain+".test.com","null"]
        for url in urls:
            for origin in origin_headers:
                tmp_headers=self.requester.HEADERS
                tmp_headers["Origin"]=origin
                resp=self.requester.send_get(url)
                if("Access-Control-Allow-Origin" in resp.headers.keys()\
                   or "test.com" in resp.text):
                    results["url"].append(url)
                    results["header"].append(origin)
                    break
            rand_sleep()
        self.report(results,"CORS",ImportanceLevel.LOW)