from thirdparty.raptor.Facebook import FacebookCert
from thirdparty.raptor.RapiDNS import RapiDNS
from thirdparty.raptor.BufferOverDNS import BufferOverDNS
from thirdparty.raptor.HackerTarget import HackerTarget
from thirdparty.raptor.NetCraft import NetCraft
from thirdparty.raptor.DNSDumpster import DNSDumpster
from thirdparty.raptor.VirusTotal import VirusTotal
from thirdparty.raptor.BinaryEdge import BinaryEdge
from thirdparty.raptor.ThreatCrowd import ThreatCrowd
from thirdparty.raptor.Sublist3r import Sublist3r
from thirdparty.raptor.ThreatMiner import ThreatMiner
from thirdparty.raptor.CertSpotter import CertSpotter 
from thirdparty.raptor.Bing import Bing
from thirdparty.raptor.AlienVault import AlienVault
from thirdparty.raptor.Google import Google
from thirdparty.raptor.Shodan import Shodan
from thirdparty.raptor.Crobat import Crobat
from thirdparty.raptor.SiteDossier import SiteDossier
from thirdparty.raptor.UrlScan import UrlScan
from thirdparty.raptor.Censys import Censys
from thirdparty.raptor.GoogleCert import GoogleCert
from concurrent.futures import ThreadPoolExecutor
from utils.utilities import *

class Raptor:
    def __init__(self):
        self._modules=[FacebookCert(),RapiDNS(),BufferOverDNS(),HackerTarget(),NetCraft(),
                      DNSDumpster(),VirusTotal(),BinaryEdge(),ThreatCrowd(),ThreatMiner(),GoogleCert(),
                      Censys(),UrlScan(),Sublist3r(),CertSpotter(),Bing(),SiteDossier(),AlienVault(),Google(),Shodan(),Crobat()]
    def save_out(self,results):
        final=list(map(lambda x:x+"\n",results))
        with open(os.path.join(Configs.ConstOutputPath,"subdomains.txt"),"w") as file:
            file.writelines(final)
    def start(self,domain):
        final=[]
        futures=[]
        with ThreadPoolExecutor(Configs.THREADS) as thread:
            for module in self._modules:
                futures.append(thread.submit(module.start,domain=domain))
        for future in futures:
            final+=future.result()
        self.save_out(list(set(final)))
        return